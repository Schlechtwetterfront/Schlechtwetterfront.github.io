<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <title>Dota - Rememberator</title>
        <link rel="stylesheet" href="./css/smoothness/jquery-ui-1.10.4.custom.css">
        <script src="js/countdown.js"></script>
        <script src="js/jquery-1.11.0.min.js"></script>
        <script src="js/jquery-ui-1.10.4.custom.js"></script>
        <script src="js/ande.js"></script>
        <link rel="stylesheet" href="css/andesimplewhite.css">
        <link rel="icon" type="image/png" href="./img/dota_logo_hover.png"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    </head>
    <body>
        <div id="top_bar">
            <div align="center">
                <div class="three">
                    <box id="game_time">00:00</box>
                    <logo>
                        <question_mark id="help">?</question_mark>
                        <volume id="sound_toggle"></volume>
                    </logo>
                    <a id="start_button" class="terminator">LOOK AT IT GO</a>
                </div>
            </div>
            <!-- <img src="./img/logo.png" style="float: right;" height="80px"> -->
        </div>
        <div id="main">
            <category_row>
                <category id="category_neutrals" class="expanded">
                    <category_button id="category_neutrals_btn">Neutrals</category_button>
                    <br><br>
                    <item id="pull_creeps">
                        Pull Creeps
                        <timer id="pull_creeps_time">
                            :13, :43, :15, :45
                        </timer>
                    </item>
                    <br>
                    <item id="stack_neutrals">
                        Stack Neutrals
                        <timer id="stack_neutrals_time">
                            :53
                        </timer>
                    </item>
                    <br>
                    <item id="roshan">
                        <startstop id="roshan_startstop"></startstop>
                        Roshan
                        <timer id="roshan_time">
                            00:00 00:00
                        </timer>
                    </item>
                    <br>
                </category>

                <category id="category_general" class="expanded">
                    <category_button id="category_general_btn">General</category_button>
                    <br><br>
                    <item id="check_rune">
                        Check Rune
                        <timer id="check_rune_time">
                            Every 2 minutes
                        </timer>
                    </item>
                    <br>
                    <item id="night">
                        Nightfall
                        <timer id="night_time">
                            Smoke ganks
                        </timer>
                    </item>
                    <br>
                    <item id="items_gn">
                        Items
                        <timer id="items_gn_time">
                            TP Scroll
                        </timer>
                    </item>
                    <br>
                </category>
            </category_row>

            <category_row>
                <category id="category_support" class="expanded">
                    <category_button id="category_support_btn">Support</category_button>
                    <br><br>
                    <item id="up_courier">
                        Flying Courier
                        <timer id="up_courier_time">
                            03:00
                        </timer>
                    </item>
                    <br>
                    <item id="items_sp">
                        Items
                        <timer id="items_sp_time">
                            Wards, Dust, Smoke
                        </timer>
                    </item>
                    <br>
                </category>

                <category id="category_dying" class="expanded">
                    <category_button id="category_dying_btn">Feeding Again?</category_button>
                    <br><br>
                    <item id="buy_shit">
                        Buy
                        <timer id="buy_shit_time">
                            Item (Components), TP Scrolls
                        </timer>
                    </item>
                    <br>
                </category>
            </category_row>
        </div>
        <div id="dialog" title="Dota Rememberator" align="center">
            <img src="./img/kappa.png"><br>
            <p>We are Kappa.<br>

            LOOK AT IT GO to start, let the clock run along the in-game clock.<br>
            Highlighted stuff is something you should be thinking of right now so you can get into position.

            <br><br>
            schlchtwtrfrnt@gmail.com<br>
            </p>
        </div>
        <audio id="sound_handle" style="display: none;"></audio>
        <script>
            var settings = {
                play_sounds: true
            };

            var time = { minutes: 0, seconds: 0 };
            var timerId = 0;

            var times = [
                { time: 35, id: 'stack_neutrals', duration: 10 },
                { time: 30, id: 'pull_creeps', duration: 10 },
                { time: 00, id: 'pull_creeps', duration: 10 },
                { time: 40, id: 'check_rune', even: false, duration: 15 },
                { time: 00, id: 'night', minute: 0, duration: 40 },
                { time: 00, id: 'up_courier', minute: 3, duration: 30 },
                { time: 10, id: 'items_sp', duration: 10 },
                { time: 10, id: 'items_gn', duration: 10 }
            ];

            var sounds = {
                start: './sound/look_at_it_go.mp3',
                stop: './sound/silence.mp3',
                roshan: './sound/roshan.mp3'
            };
            
            var roshanData = {
                target1: 0,
                target2: 0,
                timerId: 0,
                stopped: true,
                fastest: false,
                longest: false
            };

            $('#category_general_btn').click(function() {
                $('#category_general').toggleClass('expanded');
            });

            $('#category_neutrals_btn').click(function() {
                $('#category_neutrals').toggleClass('expanded');
            });

            $('#category_support_btn').click(function() {
                $('#category_support').toggleClass('expanded');
            });

            $('#category_dying_btn').click(function() {
                $('#category_dying').toggleClass('expanded');
            });

            $('#sound_toggle').click(function() {
                $('#sound_toggle').toggleClass('disabled');
                settings.play_sounds = !settings.play_sounds;
            });

            $('#help').click(function() {
                $('#dialog').dialog({modal: true, width: 500});
            });

            $('#start_button').click(function() {
                if ($('#start_button').html() == 'LOOK AT IT GO') {
                    $('#start_button').html('SILENCE');
                    start_counting();
                } else {
                    $('#start_button').html('LOOK AT IT GO');
                    stop_counting();
                }
            });

            $('#help').click(function() {

            });

            $('#roshan_startstop').click(function() {
                if (!roshanData.stopped) {
                    roshanData.stopped = true;
                    window.clearInterval(roshanData.timerId);
                    $('#roshan_startstop').toggleClass('started');
                } else {
                    roshanData.stopped = false;
                    roshanData.fastest = false;
                    roshanData.longest = false;
                    $('#roshan_startstop').toggleClass('started');
                    roshanData.target1 = new Date();
                    roshanData.target1.setSeconds(roshanData.target1.getSeconds() + 8 * 60);
                    roshanData.target2 = new Date();
                    roshanData.target2.setSeconds(roshanData.target2.getSeconds() + 11 * 60);

                    roshanData.timerId = window.setInterval(function() {
                        var cd = countdown(new Date(), roshanData.target1);
                        var cd2 = countdown(new Date(), roshanData.target2);
                        var r1 = pad(cd.minutes.toString(), 2, '0', 1) + ':' + pad(cd.seconds.toString(), 2, '0', 1);
                        var r2 = pad(cd2.minutes.toString(), 2, '0', 1) + ':' + pad(cd2.seconds.toString(), 2, '0', 1);
                        if (roshanData.fastest == true || (cd.minutes == 0 && cd.seconds == 0)) {
                            roshanData.fastest = true;
                            r1 = '00:00';
                            // soundHandle = document.getElementById('sound_handle');
                            // soundHandle.src = sounds.roshan;
                            // soundHandle.play();
                        }
                        if (roshanData.longest == true || (cd2.minutes == 0 && cd2.seconds == 0)) {
                            roshanData.longest = true;
                            r2 = '00:00';
                            // soundHandle = document.getElementById('sound_handle');
                            // soundHandle.src = sounds.roshan;
                            // soundHandle.play();
                            roshanData.stopped = true;
                        }
                        $('#roshan_time').html(r1 + ' ' + r2);
                    }, 1000);
                }
            });


            function update() {
                if (time.seconds == 59) {
                    time.seconds = 0;
                    time.minutes += 1;
                } else {
                    time.seconds += 1;
                }
                $('#game_time').html(pad(time.minutes.toString(), 2, '0', 1) + ':' + pad(time.seconds.toString(), 2, '0', 1));


                for (var i = times.length - 1; i >= 0; i--) {
                    var item = times[i];

                    if (typeof(item.even) != 'undefined') {
                        if (item.time == time.seconds && item.even == false && !even(time.minutes)) {
                            $('#' + item.id).addClass('imminent');
                            $('#' + item.id + '_time').addClass('imminent');
                        } else if (time_check(time.seconds, item.time, item.duration)) {
                            $('#' + item.id).removeClass('imminent');
                            $('#' + item.id + '_time').removeClass('imminent');
                        }
                    } else if (typeof(item.minute) != 'undefined') {
                        if(item.minute == time.minutes && item.time == time.seconds) {
                            $('#' + item.id).addClass('imminent');
                            $('#' + item.id + '_time').addClass('imminent');
                        } else  if (time_check(time.seconds, item.time, item.duration)){
                            $('#' + item.id).removeClass('imminent');
                            $('#' + item.id + '_time').removeClass('imminent');
                        }
                        if (item.id == 'night') {
                            item.minute += 4;
                        }
                    } else {
                        if (item.time == time.seconds) {
                            $('#' + item.id).addClass('imminent');
                            $('#' + item.id + '_time').addClass('imminent');
                        } else if (time_check(time.seconds, item.time, item.duration)) {
                            $('#' + item.id).removeClass('imminent');
                            $('#' + item.id + '_time').removeClass('imminent');
                        }
                    }
                };
            };

            function start_counting() {
                timerId = window.setInterval(update, 1000);
                play_sound('start');
            };

            function stop_counting() {
                window.clearInterval(timerId);
                play_sound('stop');
            };

            function play_sound(sound_name) {
                if (settings.play_sounds) {
                    soundHandle = document.getElementById('sound_handle');
                    soundHandle.src = sounds[sound_name];
                    soundHandle.play();
                }
            };

        </script>
    </body>
</html>
